<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Order Summary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS (Optional but recommended) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=<%= process.env.PAYPAL_CLIENT_ID %>&currency=USD"></script>
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">Order Summary</h2>

        <div class="card p-3 mb-4">
            <h5>Shipping Address</h5>
            <p>
                <%= address.street %>, <%= address.city %>, <%= address.district %>,<br>
                            <%= address.state %> - <%= address.pincode %>
            </p>
        </div>

        <div class="card p-3 mb-4">
            <h5>Items</h5>
            <ul class="list-group">
                <% items.forEach(item=> { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item.product.name %> x <%= item.quantity %>
                                <span>$<%= (item.product.price * item.quantity).toFixed(2) %></span>
                    </li>
                    <% }) %>
            </ul>
        </div>

        <div class="text-center">
            <h4>Total: $<%= items.reduce((sum, item)=> sum + item.product.price * item.quantity * 1.3, 0).toFixed(2) %>
            </h4>
        </div>

        <div id="paypal-button-container" class="mt-4 text-center"></div>
    </div>

    <script>
        paypal.Buttons({
            createOrder: function (data, actions) {
                return fetch("/create-paypal-order", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                })
                    .then(res => res.json())
                    .then(data => data.id);
            },
            onApprove: function (data, actions) {
                return fetch("/capture-paypal-order", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ orderID: data.orderID })
                })
                    .then(res => res.json())
                    .then(details => {
                        alert("Transaction completed successfully.");
                        window.location.href = "/my-orders";
                    });
            }
        }).render('#paypal-button-container');
    </script>
</body>

</html>